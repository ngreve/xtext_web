define("xtext/compatibility",[],function(){return Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("bind target is not callable");var t=Array.prototype.slice.call(arguments,1),r=this,i=function(){};return boundFunc=function(){var n=Array.prototype.slice.call(arguments);return r.apply(this instanceof i?this:e,t.concat(n))},i.prototype=this.prototype,boundFunc.prototype=new i,boundFunc}),Array.prototype.map||(Array.prototype.map=function(e,t){if(null==this)throw new TypeError("this is null");if("function"!=typeof e)throw new TypeError("callback is not callable");for(var r=Object(this),i=r.length>>>0,n=new Array(i),o=0;o<i;o++)o in r&&(n[o]=e.call(t,r[o],o,r));return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if(null==this)throw new TypeError("this is null");if("function"!=typeof e)throw new TypeError("callback is not callable");for(var r=Object(this),i=r.length>>>0,n=0;n<i;n++)n in r&&e.call(t,r[n],n,r)}),{}}),define("xtext/services/XtextService",["jquery"],function(e){function t(){}var r={};return t.prototype.initialize=function(){if(this._serviceType=arguments[1],"string"==typeof arguments[0]){this._requestUrl=arguments[0]+"/"+this._serviceType;var e=arguments[2];e&&(this._encodedResourceId=encodeURIComponent(e)),this._updateService=arguments[3]}else{var t=arguments[0];if(t.options){this._requestUrl=t.options.serviceUrl+"/"+this._serviceType;var e=t.options.resourceId;e&&(this._encodedResourceId=encodeURIComponent(e))}this._updateService=t.updateService}},t.prototype.setState=function(e){this._state=e},t.prototype.invoke=function(t,r,i,n){if(void 0===i&&(i=e.Deferred()),e.isFunction(this._checkPreconditions)&&!this._checkPreconditions(t,r))return i.reject(),i.promise();var o,s={contentType:r.contentType};e.isFunction(this._initServerData)&&(o=this._initServerData(s,t,r));var c="GET";o&&o.httpMethod&&(c=o.httpMethod);var a=this;if(!o||!o.suppressContent)if(r.sendFullText)s.fullText=t.getText(),c="POST";else{var u=t.getServerState();if(u.updateInProgress)return a._updateService?a._updateService.addCompletionCallback(function(){a.invoke(t,r,i)}):i.reject(),i.promise();void 0!==u.stateId&&(s.requiredStateId=u.stateId)}var v;v=e.isFunction(this._getSuccessCallback)?this._getSuccessCallback(t,r,i):function(n){if(n.conflict){if(a._increaseRecursionCount(t)){var o;if(e.isFunction(a._onConflict)&&(o=a._onConflict(t,n.conflict)),o&&o.suppressForcedUpdate||r.sendFullText||"invalidStateId"!=n.conflict||!a._updateService)a.invoke(t,r,i);else{a._updateService.addCompletionCallback(function(){a.invoke(t,r,i)});var s=t.getServerState();delete s.stateId,delete s.text,a._updateService.invoke(t,r)}}else i.reject();return!1}if(e.isFunction(a._processResult)){var c=a._processResult(n,t);if(c)return i.resolve(c),!0}i.resolve(n)};var d=function(n,o,s){if(404==n.status&&!r.loadFromServer&&a._increaseRecursionCount(t)){var c;e.isFunction(a._onConflict)&&(c=a._onConflict(t,s));var u=t.getServerState();if((!c||!c.suppressForcedUpdate)&&void 0!==u.text&&a._updateService)return a._updateService.addCompletionCallback(function(){a.invoke(t,r,i)}),delete u.stateId,delete u.text,a._updateService.invoke(t,r),!0}i.reject(s)};return a.sendRequest(t,{type:c,data:s,success:v,error:d},!r.sendFullText),i.promise().always(function(){a._recursionCount=void 0})},t.prototype.sendRequest=function(t,i,n){var o=this;o.setState("started"),t.xtextServices.options.enableCors&&(i.crossDomain=!0,i.xhrFields={withCredentials:!0});var s=i.success;i.success=function(r){var i=!0;if(e.isFunction(s)&&(i=s(r)),(i||void 0===i)&&(o.setState("finished"),t.xtextServices)){var n=t.xtextServices.successListeners;if(n)for(var c=0;c<n.length;c++){var a=n[c];e.isFunction(a)&&a(o._serviceType,r)}}};var c=i.error;i.error=function(r,i,n){var s=!1;e.isFunction(c)&&(s=c(r,i,n)),s||(o.setState(void 0),o._reportError(t,i,n,r))},i.async=!0;var a=o._requestUrl;if(!i.data.resource&&o._encodedResourceId&&(a.indexOf("?")>=0?a+="&resource="+o._encodedResourceId:a+="?resource="+o._encodedResourceId),n&&r._initPending)r._waitingRequests||(r._waitingRequests=[]),r._waitingRequests.push({requestUrl:a,settings:i});else{if(n&&!r._initDone){r._initPending=!0;var u=i.complete;i.complete=function(t,i){if(e.isFunction(u)&&u(t,i),delete r._initPending,r._initDone=!0,r._waitingRequests){for(var n=0;n<r._waitingRequests.length;n++){var o=r._waitingRequests[n];e.ajax(o.requestUrl,o.settings)}delete r._waitingRequests}}}e.ajax(a,i)}},t.prototype._increaseRecursionCount=function(e){return void 0===this._recursionCount?this._recursionCount=1:this._recursionCount++,!(this._recursionCount>=10)||(this._reportError(e,"warning","Xtext service request failed after 10 attempts.",{}),!1)},t.prototype._reportError=function(t,r,i,n){if(t.xtextServices){var o=t.xtextServices.errorListeners;if(o)for(var s=0;s<o.length;s++){var c=o[s];e.isFunction(c)&&c(this._serviceType,r,i,n)}}},t}),define("xtext/services/LoadResourceService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,r?"revert":"load",t)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){return{suppressContent:!0,httpMethod:"revert"==this._serviceType?"POST":"GET"}},r.prototype._getSuccessCallback=function(e,t,r){return function(i){e.setText(i.fullText),e.clearUndoStack(),e.setDirty(i.dirty);for(var n=e.updateServerState(i.fullText,i.stateId),o=0;o<n.length;o++)n[o](t);r.resolve(i)}},r}),define("xtext/services/SaveResourceService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"save",t)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){return{httpMethod:"POST"}},r.prototype._processResult=function(e,t){t.setDirty(!1)},r}),define("xtext/services/HighlightingService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"highlight",t)}return r.prototype=new e,r.prototype._checkPreconditions=function(e,t){return void 0===this._state},r.prototype._onConflict=function(e,t){return this.setState(void 0),{suppressForcedUpdate:!0}},r}),define("xtext/services/ValidationService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"validate",t)}return r.prototype=new e,r.prototype._checkPreconditions=function(e,t){return void 0===this._state},r.prototype._onConflict=function(e,t){return this.setState(void 0),{suppressForcedUpdate:!0}},r}),define("xtext/services/UpdateService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"update",t,this),this._completionCallbacks=[]}return r.prototype=new e,r.prototype.computeDelta=function(e,t,r){for(var i=0,n=e.length,o=t.length;i<n&&i<o&&e.charCodeAt(i)===t.charCodeAt(i);)i++;if(i!==n||i!==o){if(r.deltaOffset=i,i===n)return r.deltaText=t.substring(i,o),void(r.deltaReplaceLength=0);if(i===o)return r.deltaText="",void(r.deltaReplaceLength=n-i);for(var s=n-1,c=o-1;s>=i&&c>=i&&e.charCodeAt(s)===t.charCodeAt(c);)s--,c--;r.deltaText=t.substring(i,c+1),r.deltaReplaceLength=s-i+1}},r.prototype.onComplete=function(e,t){var r=this._completionCallbacks;this._completionCallbacks=[];for(var i=0;i<r.length;i++){(0,r[i].callback)(r[i].params)}},r.prototype.addCompletionCallback=function(e,t){this._completionCallbacks.push({callback:e,params:t})},r.prototype.invoke=function(e,r,i){void 0===i&&(i=t.Deferred());var n=e.getServerState();if(n.updateInProgress){var o=this;return this.addCompletionCallback(function(){o.invoke(e,r,i)}),i.promise()}var s={contentType:r.contentType},c=e.getText();if(r.sendFullText||void 0===n.text)s.fullText=c;else{if(this.computeDelta(n.text,c,s),void 0===s.deltaText){if(!r.forceUpdate)return i.resolve(n),this.onComplete(),i.promise();s.deltaText="",s.deltaOffset=e.getCaretOffset(),s.deltaReplaceLength=0}s.requiredStateId=n.stateId}n.updateInProgress=!0;var o=this;return o.sendRequest(e,{type:"PUT",data:s,success:function(t){if(t.conflict)return void 0!==n.text?(delete n.updateInProgress,delete n.text,delete n.stateId,o.invoke(e,r,i)):i.reject(t.conflict),!1;for(var s=e.updateServerState(c,t.stateId),a=0;a<s.length;a++)o.addCompletionCallback(s[a],r);i.resolve(t)},error:function(t,s,c){if(404==t.status&&!r.loadFromServer&&void 0!==n.text)return delete n.updateInProgress,delete n.text,delete n.stateId,o.invoke(e,r,i),!0;i.reject(c)},complete:o.onComplete.bind(o)},!0),i.promise().always(function(){n.updateInProgress=!1})},r}),define("xtext/services/ContentAssistService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"assist",t,r)}return r.prototype=new e,r.prototype.invoke=function(e,r,i){void 0===i&&(i=t.Deferred());var n={contentType:r.contentType};r.offset?n.caretOffset=r.offset:n.caretOffset=e.getCaretOffset();var o=r.selection?r.selection:e.getSelection();o.start==n.caretOffset&&o.end==n.caretOffset||(n.selectionStart=o.start,n.selectionEnd=o.end);var s,c="GET",a=void 0,u=e.getServerState();if(r.sendFullText)n.fullText=e.getText(),c="POST";else if(n.requiredStateId=u.stateId,this._updateService){if(void 0===u.text||u.updateInProgress){var v=this;return this._updateService.addCompletionCallback(function(){v.invoke(e,r,i)}),i.promise()}u.updateInProgress=!0,a=this._updateService.onComplete.bind(this._updateService),s=e.getText(),this._updateService.computeDelta(u.text,s,n),void 0!==n.deltaText&&(c="POST")}var v=this;v.sendRequest(e,{type:c,data:n,success:function(t){if(t.conflict){if(v._increaseRecursionCount(e))if(a)delete u.updateInProgress,delete u.text,delete u.stateId,v._updateService.addCompletionCallback(function(){v.invoke(e,r,i)}),v._updateService.invoke(e,r);else{var n={};for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);n.sendFullText=!0,v.invoke(e,n,i)}else i.reject(t.conflict);return!1}if(a&&void 0!==t.stateId&&t.stateId!=e.getServerState().stateId)for(var c=e.updateServerState(s,t.stateId),d=0;d<c.length;d++)v._updateService.addCompletionCallback(c[d],r);i.resolve(t.entries)},error:function(t,n,o){if(a&&404==t.status&&!r.loadFromServer&&void 0!==u.text)return delete u.updateInProgress,delete u.text,delete u.stateId,v._updateService.addCompletionCallback(function(){v.invoke(e,r,i)}),v._updateService.invoke(e,r),!0;i.reject(o)},complete:a},!r.sendFullText);var d=i.promise();return a&&d.always(function(){u.updateInProgress=!1}),d},r}),define("xtext/services/HoverService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"hover",t,r)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){r.proposal&&r.proposal.proposal&&(e.proposal=r.proposal.proposal),r.offset?e.caretOffset=r.offset:e.caretOffset=t.getCaretOffset();var i=r.selection?r.selection:t.getSelection();i.start==e.caretOffset&&i.end==e.caretOffset||(e.selectionStart=i.start,e.selectionEnd=i.end)},r.prototype._getSuccessCallback=function(e,t,r){var i=t.mouseHoverDelay;i||(i=500);var n=(new Date).getTime()+i;return function(i){if(i.conflict||!i.title&&!i.content)r.reject();else{var o=Math.max(0,n-(new Date).getTime());setTimeout(function(){t.sendFullText||void 0===i.stateId||i.stateId==e.getServerState().stateId?r.resolve(i):r.reject()},o)}}},r}),define("xtext/services/OccurrencesService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"occurrences",t,r)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){r.offset?e.caretOffset=r.offset:e.caretOffset=t.getCaretOffset()},r.prototype._getSuccessCallback=function(e,t,r){return function(i){i.conflict||!t.sendFullText&&void 0!==i.stateId&&i.stateId!=e.getServerState().stateId?r.reject():r.resolve(i)}},r}),define("xtext/services/FormattingService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"format",t,r)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){var i=r.selection?r.selection:t.getSelection();return i.end>i.start&&(e.selectionStart=i.start,e.selectionEnd=i.end),{httpMethod:"POST"}},r.prototype._processResult=function(e,t){var r;if(e.replaceRegion){var i=t.getText(),n=e.replaceRegion.offset,o=e.replaceRegion.offset+e.replaceRegion.length;t.setText(e.formattedText,n,o),r=i.substring(0,n)+e.formattedText+i.substring(o)}else t.setText(e.formattedText),r=e.formattedText;for(var s=t.updateServerState(r,e.stateId),c=0;c<s.length;c++)s[c]({})},r}),define("xtext/ServiceBuilder",["jquery","xtext/services/XtextService","xtext/services/LoadResourceService","xtext/services/SaveResourceService","xtext/services/HighlightingService","xtext/services/ValidationService","xtext/services/UpdateService","xtext/services/ContentAssistService","xtext/services/HoverService","xtext/services/OccurrencesService","xtext/services/FormattingService"],function(e,t,r,i,n,o,s,c,a,u,v){function d(e){this.services=e}return d.prototype.createServices=function(){function l(){p.highlightingService&&h.doHighlighting&&(p.highlightingService.setState(void 0),h.doHighlighting()),p.validationService&&h.doValidation&&(p.validationService.setState(void 0),h.doValidation())}var p=this.services,f=p.options,g=p.editorContext;g.xtextServices=p;var h=this;if(f.serviceUrl||(f.baseUrl?"/"!=f.baseUrl.charAt(0)&&(f.baseUrl="/"+f.baseUrl):f.baseUrl="/",f.serviceUrl=window.location.protocol+"//"+window.location.host+f.baseUrl+"xtext-service"),f.resourceId)f.xtextLang||(f.xtextLang=f.resourceId.split(/[?#]/)[0].split(".").pop()),void 0===f.loadFromServer&&(f.loadFromServer=!0),f.loadFromServer&&this.setupPersistenceServices&&(p.loadResourceService=new r(f.serviceUrl,f.resourceId,!1),p.loadResource=function(e){return p.loadResourceService.invoke(g,d.mergeOptions(e,f))},p.saveResourceService=new i(f.serviceUrl,f.resourceId),p.saveResource=function(e){return p.saveResourceService.invoke(g,d.mergeOptions(e,f))},p.revertResourceService=new r(f.serviceUrl,f.resourceId,!0),p.revertResource=function(e){return p.revertResourceService.invoke(g,d.mergeOptions(e,f))},this.setupPersistenceServices(),p.loadResource());else if(void 0===f.loadFromServer&&(f.loadFromServer=!1),f.xtextLang){var S=Math.floor(2147483648*Math.random()).toString(16);f.resourceId=S+"."+f.xtextLang}if(this.setupSyntaxHighlighting&&this.setupSyntaxHighlighting(),(f.enableHighlightingService||void 0===f.enableHighlightingService)&&(p.highlightingService=new n(f.serviceUrl,f.resourceId),p.computeHighlighting=function(e){return p.highlightingService.invoke(g,d.mergeOptions(e,f))}),(f.enableValidationService||void 0===f.enableValidationService)&&(p.validationService=new o(f.serviceUrl,f.resourceId),p.validate=function(e){return p.validationService.invoke(g,d.mergeOptions(e,f))}),this.setupUpdateService&&(f.sendFullText||(p.updateService=new s(f.serviceUrl,f.resourceId),p.update=function(e){return p.updateService.invoke(g,d.mergeOptions(e,f))},p.saveResourceService&&(p.saveResourceService._updateService=p.updateService),g.addServerStateListener(l)),this.setupUpdateService(l)),(f.enableContentAssistService||void 0===f.enableContentAssistService)&&this.setupContentAssistService&&(p.contentAssistService=new c(f.serviceUrl,f.resourceId,p.updateService),p.getContentAssist=function(e){return p.contentAssistService.invoke(g,d.mergeOptions(e,f))},this.setupContentAssistService()),(f.enableHoverService||void 0===f.enableHoverService)&&this.setupHoverService&&(p.hoverService=new a(f.serviceUrl,f.resourceId,p.updateService),p.getHoverInfo=function(e){return p.hoverService.invoke(g,d.mergeOptions(e,f))},this.setupHoverService()),(f.enableOccurrencesService||void 0===f.enableOccurrencesService)&&this.setupOccurrencesService&&(p.occurrencesService=new u(f.serviceUrl,f.resourceId,p.updateService),p.getOccurrences=function(e){return p.occurrencesService.invoke(g,d.mergeOptions(e,f))},this.setupOccurrencesService()),(f.enableFormattingService||void 0===f.enableFormattingService)&&this.setupFormattingService&&(p.formattingService=new v(f.serviceUrl,f.resourceId,p.updateService),p.format=function(e){return p.formattingService.invoke(g,d.mergeOptions(e,f))},this.setupFormattingService()),(f.enableGeneratorService||void 0===f.enableGeneratorService)&&(p.generatorService=new t,p.generatorService.initialize(p,"generate"),p.generatorService._initServerData=function(e,t,r){r.allArtifacts?e.allArtifacts=r.allArtifacts:r.artifactId&&(e.artifact=r.artifactId),void 0!==r.includeContent&&(e.includeContent=r.includeContent)},p.generate=function(e){return p.generatorService.invoke(g,d.mergeOptions(e,f))}),f.dirtyElement){var x,y=f.document||document;x="string"==typeof f.dirtyElement?e("#"+f.dirtyElement,y):e(f.dirtyElement);var m=f.dirtyStatusClass;m||(m="dirty"),g.addDirtyStateListener(function(e){e?x.addClass(m):x.removeClass(m)})}p.successListeners=[],p.errorListeners=[function(e,t,r,i){f.showErrorDialogs?window.alert("Xtext service '"+e+"' failed: "+r):console.log("Xtext service '"+e+"' failed: "+r)}]},d.prototype.changeResource=function(t){var r=this.services,i=r.options;i.resourceId=t;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];o._serviceType&&e.isFunction(o.initialize)&&r[n].initialize(i.serviceUrl,o._serviceType,t,r.updateService)}var s=r.editorContext.getServerState();delete s.stateId,delete s.text,i.loadFromServer&&e.isFunction(r.loadResource)&&r.loadResource()},d.copy=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},d.optionName=function(e){var t="data-editor-";if(e.substring(0,t.length)===t){var r=e.substring(t.length);return r=r.replace(/-([a-z])/gi,function(e,t){return t.toUpperCase()})}},d.mergeOptions=function(e,t){if(e){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}return d.copy(t)},d.mergeParentOptions=function(e,t){for(var r,i=d.copy(t),n=0,o=e.attributes,s=o.length;n<s;n++){r=o.item(n);var c=d.optionName(r.nodeName);if(c){var a=r.nodeValue;"true"!==a&&"false"!==a||(a="true"===a),i[c]=a}}return i},d}),define("xtext/OrionEditorContext",[],function(){function e(e,t){this._editorViewer=e,this._editor=e.editor,this._contentType=t,this._serverState={},this._serverStateListeners=[],this._dirty=!1,this._dirtyStateListeners=[]}return e.prototype={getServerState:function(){return this._serverState},updateServerState:function(e,t){return this._serverState.text=e,this._serverState.stateId=t,this._serverStateListeners},addServerStateListener:function(e){this._serverStateListeners.push(e)},getCaretOffset:function(){return this._editor.getTextView().getCaretOffset()},getLineStart:function(e){var t=this._editor.getTextView();return t.getLineStart(t.getLineAtOffset(t.getCaretOffset()))},getSelection:function(){return this._editor.getTextView().getSelection()},getText:function(e,t){return this._editor.getText(e,t)},isDirty:function(){return this._dirty},setDirty:function(e){if(e!=this._dirty)for(var t=0;t<this._dirtyStateListeners.length;t++)this._dirtyStateListeners[t](e);this._dirty=e},addDirtyStateListener:function(e){this._dirtyStateListeners.push(e)},clearUndoStack:function(){this._editor.getUndoStack().reset()},setCaretOffset:function(e,t){this._editor.getTextView().setCaretOffset(e,t)},setSelection:function(e){this._editor.getTextView().setSelection(e.start,e.end)},setText:function(e,t,r){if(void 0===t||void 0===r)this._editorViewer.setContents(e,this._contentType);else{var i=this._editor.getText(),n=i.substring(0,t)+e+i.substring(r);this._editorViewer.setContents(n,this._contentType)}}},e}),define("xtext/xtext-orion",["jquery","orion/Deferred","orion/keyBinding","orion/editor/annotations","embeddedEditor/builder/embeddedEditor","xtext/compatibility","xtext/ServiceBuilder","xtext/OrionEditorContext"],function(e,t,r,i,n,o,s,c){function a(e,t){this.viewer=e,s.call(this,t)}var u={};return u.createEditor=function(t){t||(t={});var r;"string"===e.type(t.parent)?r=e("#"+t.parent,t.document):t.parent?r=e(t.parent):"string"===e.type(t.parentClass)?r=e("."+t.parentClass,t.document):(r=e("#xtext-editor",t.document),0==r.length&&(r=e(".xtext-editor",t.document)));var i=t.startupOptions;i||(i={defaultPlugins:["webToolsPlugin.html"]});var o=new n(i),c=[];r.each(function(e,r){var i=s.mergeParentOptions(r,t),n=u.registerContentType(o,i);c.push({parent:r,options:i,contentType:n})});var a=e.Deferred(),v=[],d=0;return c.forEach(function(t,i){function n(e){u.createServices(e,t.options,c).options.loadFromServer||e.setContents(l,c),v[i]=e,++d==r.length&&(1==d?a.resolve(e):a.resolve(v))}function s(e){a.reject(e)}var c=t.contentType,l=e(t.parent).text(),p=o.create({parent:t.parent,contentType:c}),f=t.options.syntaxDefinition;"none"!=f&&("string"===e.type(f)||!f&&t.options.xtextLang)?(f||(f="xtext-resources/"+t.options.xtextLang+"-syntax"),require([f],function(e){t.options.syntaxDefinition=e,p.then(n,s)})):p.then(n,s)}),0==r.length&&a.reject(),a.promise()},a.prototype=new s,u.registerContentType=function(e,t){var r=t.xtextLang;!r&&t.resourceId&&(r=t.resourceId.split(/[?#]/)[0].split(".").pop());var i=t.contentType;return!i&&t.xtextLang?i="xtext/"+t.xtextLang:i||(i="xtext"),(void 0===t.randomContentType||t.randomContentType)&&(i=i+"_"+Math.floor(2147483648*Math.random()).toString(16)),e.serviceRegistry.registerService("orion.core.contenttype",{},{contentTypes:[{id:i,extension:[r],name:"Xtext Language",extends:"text/plain"}]}),i},u.createServices=function(e,t,r){!r&&t.contentType&&(r=t.contentType);var i={options:t,editorContext:new c(e,r),contentType:r,_highlightAnnotationTypes:[]},n=new a(e,i);return n.createServices(),i.serviceBuilder=n,e.xtextServices=i,i},u.removeServices=function(e){if(e.xtextServices){var t=e.xtextServices;t.highlighterRegistration&&t.highlighterRegistration.unregister(),t.modelRegistration&&t.modelRegistration.unregister(),t.contentAssistRegistration&&t.contentAssistRegistration.unregister(),t.hoverRegistration&&t.hoverRegistration.unregister(),t.occurrencesRegistration&&t.occurrencesRegistration.unregister(),t.formatCommandRegistration&&t.formatCommandRegistration.unregister(),t.saveEventListener&&e.editor.removeEventListener("InputChanged",t.saveEventListener),e.editor.showAnnotations([],t._highlightAnnotationTypes),e.editor.showProblems([]),delete e.xtextServices}},a.prototype.setupSyntaxHighlighting=function(){var t=this.services,r=t.options.syntaxDefinition;if("string"!==e.type(r)){var i=t.contentType;r.contentTypes?e.inArray(i,r.contentTypes)<0&&r.contentTypes.push(i):r.contentTypes=[i],t.highlighterRegistration=this.viewer.serviceRegistry.registerService("orion.edit.highlighter",{},r)}},a.prototype.setupUpdateService=function(e){function t(t){i._xtext_init?i._xtext_init=!1:i.setDirty(!0),i._modelChangeTimeout&&clearTimeout(i._modelChangeTimeout),i._modelChangeTimeout=setTimeout(function(){r.options.sendFullText?e():r.update()},n)}var r=this.services,i=r.editorContext,n=r.options.textUpdateDelay;n||(n=500),i._xtext_init=!0,r.modelRegistration=this.viewer.serviceRegistry.registerService("orion.edit.model",{onModelChanged:t},{contentType:[r.contentType]})},a.prototype.setupPersistenceServices=function(){var e=this.services,t=this.viewer;e.options.enableSaveAction&&(t.inputManager.setAutoSaveTimeout(-1),e.saveEventListener=function(t){t.contentsSaved&&e.saveResource()},t.editor.addEventListener("InputChanged",e.saveEventListener))},a.prototype.setupContentAssistService=function(){function e(e,n){s.mergeOptions(n,i);var o=new t;return r.contentAssistService.invoke(r.editorContext,n).done(function(e){o.resolve(e.map(function(e){return{proposal:e.proposal,prefix:e.prefix,overwrite:!0,name:e.label?e.label:e.proposal,description:e.description,additionalEdits:e.textReplacements,positions:e.editPositions,escapePosition:e.escapePosition}}))}).fail(function(){o.reject()}),o.promise}var r=this.services,i=r.options,n=this.viewer,o={name:"Xtext content assist service",contentType:[r.contentType]};i.contentAssistCharTriggers&&(o.charTriggers=i.contentAssistCharTriggers,o.excludedStyles=i.contentAssistExcludedStyles,n.settings&&(n.settings.contentAssistAutoTrigger=!0)),r.contentAssistRegistration=n.serviceRegistry.registerService("orion.edit.contentAssist",{computeContentAssist:e},o)},a.prototype._getHighlightAnnotationType=function(e){if(i.AnnotationType.getType(e))return e;var t={title:e,style:{styleClass:"annotation "+e},html:"<div class='annotationHTML "+e+"'></div>",overviewStyle:{styleClass:"annotationOverview "+e}};t.rangeStyle={styleClass:"annotationRange "+e};var r=i.AnnotationType.registerType(e,t);return this.services._highlightAnnotationTypes.push(r),this.viewer.editor.getAnnotationStyler().addAnnotationType(r),r},a.prototype.doHighlighting=function(){var e=this.viewer,t=this.services,r=this;t.computeHighlighting().done(function(i){for(var n=[],o=0;o<i.regions.length;++o){var s=i.regions[o];s.styleClasses.forEach(function(e){n.push({description:"",start:s.offset,end:s.offset+s.length,styleClass:e})})}e.editor.showAnnotations(n,t._highlightAnnotationTypes,null,function(i){return r._getHighlightAnnotationType(i.styleClass,e,t)})})},a.prototype.doValidation=function(){var e=this.viewer;this.services.validate().done(function(t){e.editor.getEditorContext().showMarkers(t.issues.map(function(e){return{description:e.description,start:e.offset,end:e.offset+e.length,severity:e.severity}}))})},a.prototype.setupHoverService=function(){function e(e,n){var o=new t;return s.mergeOptions(n,i),r.hoverService.invoke(r.editorContext,n).done(function(e){o.resolve({content:e.title+e.content,type:"html"})}).fail(function(){o.resolve(null)}),o.promise}var r=this.services,i=r.options;r.hoverRegistration=this.viewer.serviceRegistry.registerService("orion.edit.hover",{computeHoverInfo:e},{name:"Xtext hover service",contentType:[r.contentType]})},a.prototype.setupOccurrencesService=function(){function e(e,n){var o=new t;return s.mergeOptions(n,i),r.occurrencesService.invoke(r.editorContext,n).done(function(e){var t=e.readRegions.map(function(e){return{start:e.offset,end:e.offset+e.length,readAccess:!0}}),r=e.writeRegions.map(function(e){return{start:e.offset,end:e.offset+e.length,readAccess:!1}});o.resolve(t.concat(r))}).fail(function(){o.resolve({})}),o.promise}var r=this.services,i=r.options,n=this.viewer;n.settings&&(n.settings.showOccurrences=!0),r.occurrencesRegistration=n.serviceRegistry.registerService("orion.edit.occurrences",{computeOccurrences:e},{contentType:[r.contentType]})},a.prototype.setupFormattingService=function(){function e(e,n){var o=new t;return s.mergeOptions(n,i),r.formattingService.invoke(r.editorContext,n).done(function(e){o.resolve()}).fail(function(){o.reject()}),o.promise}var r=this.services,i=r.options;i.enableFormattingAction&&(r.formatCommandRegistration=this.viewer.serviceRegistry.registerService("orion.edit.command",{execute:e},{name:"Xtext formatting service",id:"xtext.formatter",key:["f",!0,!0],contentType:[r.contentType]}))},u});