define("xtext/compatibility",[],function(){return Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("bind target is not callable");var t=Array.prototype.slice.call(arguments,1),r=this,i=function(){};return boundFunc=function(){var n=Array.prototype.slice.call(arguments);return r.apply(this instanceof i?this:e,t.concat(n))},i.prototype=this.prototype,boundFunc.prototype=new i,boundFunc}),Array.prototype.map||(Array.prototype.map=function(e,t){if(null==this)throw new TypeError("this is null");if("function"!=typeof e)throw new TypeError("callback is not callable");for(var r=Object(this),i=r.length>>>0,n=new Array(i),o=0;o<i;o++)o in r&&(n[o]=e.call(t,r[o],o,r));return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if(null==this)throw new TypeError("this is null");if("function"!=typeof e)throw new TypeError("callback is not callable");for(var r=Object(this),i=r.length>>>0,n=0;n<i;n++)n in r&&e.call(t,r[n],n,r)}),{}}),define("xtext/services/XtextService",["jquery"],function(e){function t(){}var r={};return t.prototype.initialize=function(){if(this._serviceType=arguments[1],"string"==typeof arguments[0]){this._requestUrl=arguments[0]+"/"+this._serviceType;var e=arguments[2];e&&(this._encodedResourceId=encodeURIComponent(e)),this._updateService=arguments[3]}else{var t=arguments[0];if(t.options){this._requestUrl=t.options.serviceUrl+"/"+this._serviceType;var e=t.options.resourceId;e&&(this._encodedResourceId=encodeURIComponent(e))}this._updateService=t.updateService}},t.prototype.setState=function(e){this._state=e},t.prototype.invoke=function(t,r,i,n){if(void 0===i&&(i=e.Deferred()),e.isFunction(this._checkPreconditions)&&!this._checkPreconditions(t,r))return i.reject(),i.promise();var o,s={contentType:r.contentType};e.isFunction(this._initServerData)&&(o=this._initServerData(s,t,r));var a="GET";o&&o.httpMethod&&(a=o.httpMethod);var c=this;if(!o||!o.suppressContent)if(r.sendFullText)s.fullText=t.getText(),a="POST";else{var u=t.getServerState();if(u.updateInProgress)return c._updateService?c._updateService.addCompletionCallback(function(){c.invoke(t,r,i)}):i.reject(),i.promise();void 0!==u.stateId&&(s.requiredStateId=u.stateId)}var d;d=e.isFunction(this._getSuccessCallback)?this._getSuccessCallback(t,r,i):function(n){if(n.conflict){if(c._increaseRecursionCount(t)){var o;if(e.isFunction(c._onConflict)&&(o=c._onConflict(t,n.conflict)),o&&o.suppressForcedUpdate||r.sendFullText||"invalidStateId"!=n.conflict||!c._updateService)c.invoke(t,r,i);else{c._updateService.addCompletionCallback(function(){c.invoke(t,r,i)});var s=t.getServerState();delete s.stateId,delete s.text,c._updateService.invoke(t,r)}}else i.reject();return!1}if(e.isFunction(c._processResult)){var a=c._processResult(n,t);if(a)return i.resolve(a),!0}i.resolve(n)};var v=function(n,o,s){if(404==n.status&&!r.loadFromServer&&c._increaseRecursionCount(t)){var a;e.isFunction(c._onConflict)&&(a=c._onConflict(t,s));var u=t.getServerState();if((!a||!a.suppressForcedUpdate)&&void 0!==u.text&&c._updateService)return c._updateService.addCompletionCallback(function(){c.invoke(t,r,i)}),delete u.stateId,delete u.text,c._updateService.invoke(t,r),!0}i.reject(s)};return c.sendRequest(t,{type:a,data:s,success:d,error:v},!r.sendFullText),i.promise().always(function(){c._recursionCount=void 0})},t.prototype.sendRequest=function(t,i,n){var o=this;o.setState("started"),t.xtextServices.options.enableCors&&(i.crossDomain=!0,i.xhrFields={withCredentials:!0});var s=i.success;i.success=function(r){var i=!0;if(e.isFunction(s)&&(i=s(r)),(i||void 0===i)&&(o.setState("finished"),t.xtextServices)){var n=t.xtextServices.successListeners;if(n)for(var a=0;a<n.length;a++){var c=n[a];e.isFunction(c)&&c(o._serviceType,r)}}};var a=i.error;i.error=function(r,i,n){var s=!1;e.isFunction(a)&&(s=a(r,i,n)),s||(o.setState(void 0),o._reportError(t,i,n,r))},i.async=!0;var c=o._requestUrl;if(!i.data.resource&&o._encodedResourceId&&(c.indexOf("?")>=0?c+="&resource="+o._encodedResourceId:c+="?resource="+o._encodedResourceId),n&&r._initPending)r._waitingRequests||(r._waitingRequests=[]),r._waitingRequests.push({requestUrl:c,settings:i});else{if(n&&!r._initDone){r._initPending=!0;var u=i.complete;i.complete=function(t,i){if(e.isFunction(u)&&u(t,i),delete r._initPending,r._initDone=!0,r._waitingRequests){for(var n=0;n<r._waitingRequests.length;n++){var o=r._waitingRequests[n];e.ajax(o.requestUrl,o.settings)}delete r._waitingRequests}}}e.ajax(c,i)}},t.prototype._increaseRecursionCount=function(e){return void 0===this._recursionCount?this._recursionCount=1:this._recursionCount++,!(this._recursionCount>=10)||(this._reportError(e,"warning","Xtext service request failed after 10 attempts.",{}),!1)},t.prototype._reportError=function(t,r,i,n){if(t.xtextServices){var o=t.xtextServices.errorListeners;if(o)for(var s=0;s<o.length;s++){var a=o[s];e.isFunction(a)&&a(this._serviceType,r,i,n)}}},t}),define("xtext/services/LoadResourceService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,r?"revert":"load",t)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){return{suppressContent:!0,httpMethod:"revert"==this._serviceType?"POST":"GET"}},r.prototype._getSuccessCallback=function(e,t,r){return function(i){e.setText(i.fullText),e.clearUndoStack(),e.setDirty(i.dirty);for(var n=e.updateServerState(i.fullText,i.stateId),o=0;o<n.length;o++)n[o](t);r.resolve(i)}},r}),define("xtext/services/SaveResourceService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"save",t)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){return{httpMethod:"POST"}},r.prototype._processResult=function(e,t){t.setDirty(!1)},r}),define("xtext/services/HighlightingService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"highlight",t)}return r.prototype=new e,r.prototype._checkPreconditions=function(e,t){return void 0===this._state},r.prototype._onConflict=function(e,t){return this.setState(void 0),{suppressForcedUpdate:!0}},r}),define("xtext/services/ValidationService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"validate",t)}return r.prototype=new e,r.prototype._checkPreconditions=function(e,t){return void 0===this._state},r.prototype._onConflict=function(e,t){return this.setState(void 0),{suppressForcedUpdate:!0}},r}),define("xtext/services/UpdateService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t){this.initialize(e,"update",t,this),this._completionCallbacks=[]}return r.prototype=new e,r.prototype.computeDelta=function(e,t,r){for(var i=0,n=e.length,o=t.length;i<n&&i<o&&e.charCodeAt(i)===t.charCodeAt(i);)i++;if(i!==n||i!==o){if(r.deltaOffset=i,i===n)return r.deltaText=t.substring(i,o),void(r.deltaReplaceLength=0);if(i===o)return r.deltaText="",void(r.deltaReplaceLength=n-i);for(var s=n-1,a=o-1;s>=i&&a>=i&&e.charCodeAt(s)===t.charCodeAt(a);)s--,a--;r.deltaText=t.substring(i,a+1),r.deltaReplaceLength=s-i+1}},r.prototype.onComplete=function(e,t){var r=this._completionCallbacks;this._completionCallbacks=[];for(var i=0;i<r.length;i++){(0,r[i].callback)(r[i].params)}},r.prototype.addCompletionCallback=function(e,t){this._completionCallbacks.push({callback:e,params:t})},r.prototype.invoke=function(e,r,i){void 0===i&&(i=t.Deferred());var n=e.getServerState();if(n.updateInProgress){var o=this;return this.addCompletionCallback(function(){o.invoke(e,r,i)}),i.promise()}var s={contentType:r.contentType},a=e.getText();if(r.sendFullText||void 0===n.text)s.fullText=a;else{if(this.computeDelta(n.text,a,s),void 0===s.deltaText){if(!r.forceUpdate)return i.resolve(n),this.onComplete(),i.promise();s.deltaText="",s.deltaOffset=e.getCaretOffset(),s.deltaReplaceLength=0}s.requiredStateId=n.stateId}n.updateInProgress=!0;var o=this;return o.sendRequest(e,{type:"PUT",data:s,success:function(t){if(t.conflict)return void 0!==n.text?(delete n.updateInProgress,delete n.text,delete n.stateId,o.invoke(e,r,i)):i.reject(t.conflict),!1;for(var s=e.updateServerState(a,t.stateId),c=0;c<s.length;c++)o.addCompletionCallback(s[c],r);i.resolve(t)},error:function(t,s,a){if(404==t.status&&!r.loadFromServer&&void 0!==n.text)return delete n.updateInProgress,delete n.text,delete n.stateId,o.invoke(e,r,i),!0;i.reject(a)},complete:o.onComplete.bind(o)},!0),i.promise().always(function(){n.updateInProgress=!1})},r}),define("xtext/services/ContentAssistService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"assist",t,r)}return r.prototype=new e,r.prototype.invoke=function(e,r,i){void 0===i&&(i=t.Deferred());var n={contentType:r.contentType};r.offset?n.caretOffset=r.offset:n.caretOffset=e.getCaretOffset();var o=r.selection?r.selection:e.getSelection();o.start==n.caretOffset&&o.end==n.caretOffset||(n.selectionStart=o.start,n.selectionEnd=o.end);var s,a="GET",c=void 0,u=e.getServerState();if(r.sendFullText)n.fullText=e.getText(),a="POST";else if(n.requiredStateId=u.stateId,this._updateService){if(void 0===u.text||u.updateInProgress){var d=this;return this._updateService.addCompletionCallback(function(){d.invoke(e,r,i)}),i.promise()}u.updateInProgress=!0,c=this._updateService.onComplete.bind(this._updateService),s=e.getText(),this._updateService.computeDelta(u.text,s,n),void 0!==n.deltaText&&(a="POST")}var d=this;d.sendRequest(e,{type:a,data:n,success:function(t){if(t.conflict){if(d._increaseRecursionCount(e))if(c)delete u.updateInProgress,delete u.text,delete u.stateId,d._updateService.addCompletionCallback(function(){d.invoke(e,r,i)}),d._updateService.invoke(e,r);else{var n={};for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);n.sendFullText=!0,d.invoke(e,n,i)}else i.reject(t.conflict);return!1}if(c&&void 0!==t.stateId&&t.stateId!=e.getServerState().stateId)for(var a=e.updateServerState(s,t.stateId),v=0;v<a.length;v++)d._updateService.addCompletionCallback(a[v],r);i.resolve(t.entries)},error:function(t,n,o){if(c&&404==t.status&&!r.loadFromServer&&void 0!==u.text)return delete u.updateInProgress,delete u.text,delete u.stateId,d._updateService.addCompletionCallback(function(){d.invoke(e,r,i)}),d._updateService.invoke(e,r),!0;i.reject(o)},complete:c},!r.sendFullText);var v=i.promise();return c&&v.always(function(){u.updateInProgress=!1}),v},r}),define("xtext/services/HoverService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"hover",t,r)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){r.proposal&&r.proposal.proposal&&(e.proposal=r.proposal.proposal),r.offset?e.caretOffset=r.offset:e.caretOffset=t.getCaretOffset();var i=r.selection?r.selection:t.getSelection();i.start==e.caretOffset&&i.end==e.caretOffset||(e.selectionStart=i.start,e.selectionEnd=i.end)},r.prototype._getSuccessCallback=function(e,t,r){var i=t.mouseHoverDelay;i||(i=500);var n=(new Date).getTime()+i;return function(i){if(i.conflict||!i.title&&!i.content)r.reject();else{var o=Math.max(0,n-(new Date).getTime());setTimeout(function(){t.sendFullText||void 0===i.stateId||i.stateId==e.getServerState().stateId?r.resolve(i):r.reject()},o)}}},r}),define("xtext/services/OccurrencesService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"occurrences",t,r)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){r.offset?e.caretOffset=r.offset:e.caretOffset=t.getCaretOffset()},r.prototype._getSuccessCallback=function(e,t,r){return function(i){i.conflict||!t.sendFullText&&void 0!==i.stateId&&i.stateId!=e.getServerState().stateId?r.reject():r.resolve(i)}},r}),define("xtext/services/FormattingService",["xtext/services/XtextService","jquery"],function(e,t){function r(e,t,r){this.initialize(e,"format",t,r)}return r.prototype=new e,r.prototype._initServerData=function(e,t,r){var i=r.selection?r.selection:t.getSelection();return i.end>i.start&&(e.selectionStart=i.start,e.selectionEnd=i.end),{httpMethod:"POST"}},r.prototype._processResult=function(e,t){var r;if(e.replaceRegion){var i=t.getText(),n=e.replaceRegion.offset,o=e.replaceRegion.offset+e.replaceRegion.length;t.setText(e.formattedText,n,o),r=i.substring(0,n)+e.formattedText+i.substring(o)}else t.setText(e.formattedText),r=e.formattedText;for(var s=t.updateServerState(r,e.stateId),a=0;a<s.length;a++)s[a]({})},r}),define("xtext/ServiceBuilder",["jquery","xtext/services/XtextService","xtext/services/LoadResourceService","xtext/services/SaveResourceService","xtext/services/HighlightingService","xtext/services/ValidationService","xtext/services/UpdateService","xtext/services/ContentAssistService","xtext/services/HoverService","xtext/services/OccurrencesService","xtext/services/FormattingService"],function(e,t,r,i,n,o,s,a,c,u,d){function v(e){this.services=e}return v.prototype.createServices=function(){function l(){p.highlightingService&&g.doHighlighting&&(p.highlightingService.setState(void 0),g.doHighlighting()),p.validationService&&g.doValidation&&(p.validationService.setState(void 0),g.doValidation())}var p=this.services,f=p.options,h=p.editorContext;h.xtextServices=p;var g=this;if(f.serviceUrl||(f.baseUrl?"/"!=f.baseUrl.charAt(0)&&(f.baseUrl="/"+f.baseUrl):f.baseUrl="/",f.serviceUrl=window.location.protocol+"//"+window.location.host+f.baseUrl+"xtext-service"),f.resourceId)f.xtextLang||(f.xtextLang=f.resourceId.split(/[?#]/)[0].split(".").pop()),void 0===f.loadFromServer&&(f.loadFromServer=!0),f.loadFromServer&&this.setupPersistenceServices&&(p.loadResourceService=new r(f.serviceUrl,f.resourceId,!1),p.loadResource=function(e){return p.loadResourceService.invoke(h,v.mergeOptions(e,f))},p.saveResourceService=new i(f.serviceUrl,f.resourceId),p.saveResource=function(e){return p.saveResourceService.invoke(h,v.mergeOptions(e,f))},p.revertResourceService=new r(f.serviceUrl,f.resourceId,!0),p.revertResource=function(e){return p.revertResourceService.invoke(h,v.mergeOptions(e,f))},this.setupPersistenceServices(),p.loadResource());else if(void 0===f.loadFromServer&&(f.loadFromServer=!1),f.xtextLang){var S=Math.floor(2147483648*Math.random()).toString(16);f.resourceId=S+"."+f.xtextLang}if(this.setupSyntaxHighlighting&&this.setupSyntaxHighlighting(),(f.enableHighlightingService||void 0===f.enableHighlightingService)&&(p.highlightingService=new n(f.serviceUrl,f.resourceId),p.computeHighlighting=function(e){return p.highlightingService.invoke(h,v.mergeOptions(e,f))}),(f.enableValidationService||void 0===f.enableValidationService)&&(p.validationService=new o(f.serviceUrl,f.resourceId),p.validate=function(e){return p.validationService.invoke(h,v.mergeOptions(e,f))}),this.setupUpdateService&&(f.sendFullText||(p.updateService=new s(f.serviceUrl,f.resourceId),p.update=function(e){return p.updateService.invoke(h,v.mergeOptions(e,f))},p.saveResourceService&&(p.saveResourceService._updateService=p.updateService),h.addServerStateListener(l)),this.setupUpdateService(l)),(f.enableContentAssistService||void 0===f.enableContentAssistService)&&this.setupContentAssistService&&(p.contentAssistService=new a(f.serviceUrl,f.resourceId,p.updateService),p.getContentAssist=function(e){return p.contentAssistService.invoke(h,v.mergeOptions(e,f))},this.setupContentAssistService()),(f.enableHoverService||void 0===f.enableHoverService)&&this.setupHoverService&&(p.hoverService=new c(f.serviceUrl,f.resourceId,p.updateService),p.getHoverInfo=function(e){return p.hoverService.invoke(h,v.mergeOptions(e,f))},this.setupHoverService()),(f.enableOccurrencesService||void 0===f.enableOccurrencesService)&&this.setupOccurrencesService&&(p.occurrencesService=new u(f.serviceUrl,f.resourceId,p.updateService),p.getOccurrences=function(e){return p.occurrencesService.invoke(h,v.mergeOptions(e,f))},this.setupOccurrencesService()),(f.enableFormattingService||void 0===f.enableFormattingService)&&this.setupFormattingService&&(p.formattingService=new d(f.serviceUrl,f.resourceId,p.updateService),p.format=function(e){return p.formattingService.invoke(h,v.mergeOptions(e,f))},this.setupFormattingService()),(f.enableGeneratorService||void 0===f.enableGeneratorService)&&(p.generatorService=new t,p.generatorService.initialize(p,"generate"),p.generatorService._initServerData=function(e,t,r){r.allArtifacts?e.allArtifacts=r.allArtifacts:r.artifactId&&(e.artifact=r.artifactId),void 0!==r.includeContent&&(e.includeContent=r.includeContent)},p.generate=function(e){return p.generatorService.invoke(h,v.mergeOptions(e,f))}),f.dirtyElement){var x,m=f.document||document;x="string"==typeof f.dirtyElement?e("#"+f.dirtyElement,m):e(f.dirtyElement);var y=f.dirtyStatusClass;y||(y="dirty"),h.addDirtyStateListener(function(e){e?x.addClass(y):x.removeClass(y)})}p.successListeners=[],p.errorListeners=[function(e,t,r,i){f.showErrorDialogs?window.alert("Xtext service '"+e+"' failed: "+r):console.log("Xtext service '"+e+"' failed: "+r)}]},v.prototype.changeResource=function(t){var r=this.services,i=r.options;i.resourceId=t;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];o._serviceType&&e.isFunction(o.initialize)&&r[n].initialize(i.serviceUrl,o._serviceType,t,r.updateService)}var s=r.editorContext.getServerState();delete s.stateId,delete s.text,i.loadFromServer&&e.isFunction(r.loadResource)&&r.loadResource()},v.copy=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},v.optionName=function(e){var t="data-editor-";if(e.substring(0,t.length)===t){var r=e.substring(t.length);return r=r.replace(/-([a-z])/gi,function(e,t){return t.toUpperCase()})}},v.mergeOptions=function(e,t){if(e){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}return v.copy(t)},v.mergeParentOptions=function(e,t){for(var r,i=v.copy(t),n=0,o=e.attributes,s=o.length;n<s;n++){r=o.item(n);var a=v.optionName(r.nodeName);if(a){var c=r.nodeValue;"true"!==c&&"false"!==c||(c="true"===c),i[a]=c}}return i},v}),define("xtext/AceEditorContext",[],function(){function e(e){this._editor=e,this._serverState={},this._serverStateListeners=[],this._dirty=!1,this._dirtyStateListeners=[]}return e.prototype={getServerState:function(){return this._serverState},updateServerState:function(e,t){return this._serverState.text=e,this._serverState.stateId=t,this._serverStateListeners},addServerStateListener:function(e){this._serverStateListeners.push(e)},getCaretOffset:function(){var e=this._editor.getCursorPosition();return this._editor.getSession().getDocument().positionToIndex(e)},getLineStart:function(e){return this._editor.getCursorPosition().row},getSelection:function(){var e=this._editor.getSelectionRange(),t=this._editor.getSession().getDocument();return{start:t.positionToIndex(e.start),end:t.positionToIndex(e.end)}},getText:function(e,t){var r=this._editor.getSession();if(e&&t){var i=r.getDocument(),n=i.indexToPosition(e),o=i.indexToPosition(t),s=require("ace/range");return r.getTextRange(new s.Range(n.row,n.column,o.row,o.column))}return r.getValue()},isDirty:function(){return this._dirty},setDirty:function(e){if(e!=this._dirty)for(var t=0;t<this._dirtyStateListeners.length;t++)this._dirtyStateListeners[t](e);this._dirty=e},addDirtyStateListener:function(e){this._dirtyStateListeners.push(e)},clearUndoStack:function(){this._editor.getSession().getUndoManager().reset()},setCaretOffset:function(e){var t=this._editor.getSession().getDocument().indexToPosition(e);this._editor.moveCursorTo(t.row,t.column)},setSelection:function(e){if(this._editor.selection){var t=this._editor.getSession().getDocument(),r=t.indexToPosition(e.start),i=t.indexToPosition(e.end);this._editor.selection.setSelectionRange(new mRange.Range(r.row,r.column,i.row,i.column))}},setText:function(e,t,r){var i=this._editor.getSession(),n=i.getDocument();t||(t=0),r||(r=n.getValue().length);var o=n.indexToPosition(t),s=n.indexToPosition(r),a=this._editor.getCursorPosition(),c=require("ace/range");i.replace(new c.Range(o.row,o.column,s.row,s.column),e),this._editor.moveCursorToPosition(a),this._editor.clearSelection()}},e}),define("xtext/xtext-ace",["jquery","ace/ace","ace/ext/language_tools","xtext/compatibility","xtext/ServiceBuilder","xtext/AceEditorContext"],function(e,t,r,i,n,o){function s(e,t){this.editor=e,t.editorContext._annotations=[],t.editorContext._occurrenceMarkers=[],n.call(this,t)}var a={};return a.createEditor=function(r){r||(r={});var i;"string"===e.type(r.parent)?i=e("#"+r.parent,r.document):r.parent?i=e(r.parent):"string"===e.type(r.parentClass)?i=e("."+r.parentClass,r.document):(i=e("#xtext-editor",r.document),0==i.length&&(i=e(".xtext-editor",r.document)));var o=[];return i.each(function(i,s){var c=t.edit(s);c.$blockScrolling=1/0,r.position&&e(s).css("position",r.position);var u=n.mergeParentOptions(s,r);a.createServices(c,u),u.theme?c.setTheme(u.theme):c.setTheme("ace/theme/eclipse"),o[i]=c}),1==o.length?o[0]:o},s.prototype=new n,a.createServices=function(e,t){var r={options:t,editorContext:new o(e)},i=new s(e,r);return i.createServices(),r.serviceBuilder=i,e.xtextServices=r,r},a.removeServices=function(e){if(e.xtextServices){var t=e.xtextServices,r=e.getSession();t.modelChangeListener&&e.off("change",t.modelChangeListener),t.changeCursorListener&&e.getSelection().off("changeCursor",t.changeCursorListener),e.commands&&(t.options.enableSaveAction&&e.commands.removeCommand("xtext-save"),t.options.enableFormattingAction&&e.commands.removeCommand("xtext-format")),t.contentAssistService&&e.setOptions({enableBasicAutocompletion:!1});var i=t.editorContext,n=i._annotations;if(n){for(var o=0;o<n.length;o++)r.removeMarker(n[o].markerId);r.setAnnotations([])}var s=i._occurrenceMarkers;if(s)for(var o=0;o<s.length;o++)r.removeMarker(s[o]);delete e.xtextServices}},s.prototype.setupSyntaxHighlighting=function(){var e=this.services.options,t=this.editor.getSession();if("none"!=e.syntaxDefinition&&(e.syntaxDefinition||e.xtextLang)){var r=e.syntaxDefinition;r||(r="xtext-resources/mode-"+e.xtextLang),"string"==typeof r?require([r],function(e){t.setMode(new e.Mode)}):r.Mode&&t.setMode(new r.Mode)}},s.prototype.setupUpdateService=function(e){var t=this.services,r=t.editorContext,i=t.options.textUpdateDelay;i||(i=500),t.modelChangeListener=function(n){n._xtext_init||r.setDirty(!0),r._modelChangeTimeout&&clearTimeout(r._modelChangeTimeout),r._modelChangeTimeout=setTimeout(function(){t.options.sendFullText?e():t.update()},i)},t.options.resourceId&&t.options.loadFromServer||t.modelChangeListener({_xtext_init:!0}),this.editor.on("change",t.modelChangeListener)},s.prototype.setupPersistenceServices=function(){var e=this.services;e.options.enableSaveAction&&this.editor.commands&&this.editor.commands.addCommand({name:"xtext-save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(t){e.saveResource()}})},s.prototype.setupContentAssistService=function(){var e={getCompletions:function(e,t,r,i,o){var s=e.xtextServices,a=n.copy(s.options),c=t.getDocument();a.offset=c.positionToIndex(r);var u=e.getSelectionRange();a.selection={start:c.positionToIndex(u.start),end:c.positionToIndex(u.end)},s.contentAssistService.invoke(s.editorContext,a).done(function(e){o(null,e.map(function(e,t,r){return{value:e.proposal,caption:e.label?e.label:e.proposal,meta:e.description,score:r.length-t}}))})}};this.editor.setOptions({enableBasicAutocompletion:[e]})},s.prototype._addMarker=function(e,t,r,i,n){var o=e.getDocument(),s=o.indexToPosition(t),a=o.indexToPosition(r),c=require("ace/range"),u=new c.Range(s.row,s.column,a.row,a.column);return e.addMarker(u,"xtext-marker_"+i,"text")},s.prototype.doValidation=function(){var e=this.services,t=e.editorContext,r=this.editor.getSession(),i=this;e.validate().always(function(){var e=t._annotations;if(e)for(var i=0;i<e.length;i++){var n=e[i];r.removeMarker(n.markerId)}t._annotations=[]}).done(function(e){for(var n=0;n<e.issues.length;n++){var o=e.issues[n],s=i._addMarker(r,o.offset,o.offset+o.length,o.severity),a=r.getDocument().indexToPosition(o.offset);t._annotations.push({row:a.row,column:a.column,text:o.description,type:o.severity,markerId:s})}r.setAnnotations(t._annotations)})},s.prototype.setupOccurrencesService=function(){var e=this.services,t=e.editorContext,r=e.options.selectionUpdateDelay;r||(r=550);var i=this.editor,o=i.getSession(),s=this;e.changeCursorListener=function(){t._selectionChangeTimeout&&clearTimeout(t._selectionChangeTimeout),t._selectionChangeTimeout=setTimeout(function(){var r=n.copy(e.options);r.offset=o.getDocument().positionToIndex(i.getSelection().getCursor()),e.occurrencesService.invoke(t,r).always(function(){var e=t._occurrenceMarkers;if(e)for(var r=0;r<e.length;r++){var i=e[r];o.removeMarker(i)}t._occurrenceMarkers=[]}).done(function(e){for(var r=0;r<e.readRegions.length;r++){var i=e.readRegions[r],n=s._addMarker(o,i.offset,i.offset+i.length,"read");t._occurrenceMarkers.push(n)}for(var r=0;r<e.writeRegions.length;r++){var i=e.writeRegions[r],n=s._addMarker(o,i.offset,i.offset+i.length,"write");t._occurrenceMarkers.push(n)}})},r)},i.getSelection().on("changeCursor",e.changeCursorListener)},s.prototype.setupFormattingService=function(){var e=this.services;e.options.enableFormattingAction&&this.editor.commands&&this.editor.commands.addCommand({name:"xtext-format",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Shift-F"},exec:function(t){e.format()}})},a});